<?php

/**
 * @file
 * Main module file.
 */

define('APPLE_NEWS_API_VERSION', 1);

// Load batch helper functions.
module_load_include('inc', 'apple_news', 'apple_news.batch');

/**
 * Implements hook_hook_info().
 */
function apple_news_hook_info() {

  $form = array(
    'group' => 'form'
  );

  // Form hooks see {module_name}.form.inc
  $hooks['form_alter'] = $form;

  $entity = array(
    'group' => 'entity'
  );

  // Entity hooks see {module_name}.entity.inc
  $hooks['entity_load'] = $entity;
  $hooks['entity_insert'] = $entity;
  $hooks['entity_update'] = $entity;
  $hooks['entity_delete'] = $entity;
  $hooks['entity_presave'] = $entity;

  return $hooks;

}

/**
 * Implements hook_help().
 */
function apple_news_help($path, $arg) {
  switch ($path) {
    case 'admin/help#apple_news':
      return '<p>' . t('Push content to <a href="https://www.apple.com/news/">Apple News</a>.') . '</p>';
  }
}

/**
 * Implements hook_permission().
 */
function apple_news_permission() {
  return array(
    'administer apple news' => array(
      'title' => t('Administer Apple News'),
      'description' => t('Perform administration tasks for Apple News'),
    ),
    'push content to apple news' => array(
      'title' => t('Push content to Apple News'),
      'description' => '',
    ),
  );
}

/**
 * Implements hook_menu().
 */
function apple_news_menu() {

  $items['admin/config/content/apple-news'] = array(
    'title' => 'Apple News',
    'description' => t('Configure content export to Apple News.'),
    'page callback' => 'drupal_get_form',
    'page arguments' => array('apple_news_settings_exports_form'),
    'access arguments' => array('administer apple news'),
    'file' => 'apple_news.admin.inc',
  );

  $items['admin/config/content/apple-news/exports'] = array(
    'title' => 'Exports',
    'description' => t('List and edit Apple News export configurations.'),
    'type' => MENU_DEFAULT_LOCAL_TASK,
    'weight' => 0,
  );

  $items['admin/config/content/apple-news/exports/%apple_news_export/edit'] = array(
    'title' => 'Edit Export',
    'description' => t('Apple News Export configuration.'),
    'page callback' => 'drupal_get_form',
    'page arguments' => array('apple_news_export_edit_form', 5),
    'access arguments' => array('administer apple news'),
    'file' => 'apple_news.admin.inc',
  );

  $items['admin/config/content/apple-news/settings'] = array(
    'title' => 'Settings',
    'description' => t('Apple News Push API configuration.'),
    'page callback' => 'drupal_get_form',
    'page arguments' => array('apple_news_settings_api_credentials_form'),
    'access arguments' => array('administer apple news'),
    'file' => 'apple_news.admin.inc',
    'type' => MENU_LOCAL_TASK,
    'weight' => 1,
  );

  $items['admin/config/content/apple-news/settings/default'] = array(
    'title' => 'Credentials',
    'description' => t('Apple News Push API credentials.'),
    'type' => MENU_DEFAULT_LOCAL_TASK,
    'weight' => 1,
  );

  $items['admin/config/content/apple-news/settings/delete'] = array(
    'title' => 'Delete configuration',
    'description' => t('Delete Apple News configuration.'),
    'page callback' => 'drupal_get_form',
    'page arguments' => array('apple_news_settings_delete_configuration_form'),
    'access arguments' => array('administer apple news'),
    'file' => 'apple_news.admin.inc',
    'weight' => 1,
  );

  $items['admin/config/content/apple-news/settings/channels'] = array(
    'title' => 'Feeds',
    'description' => t('Apple News Push API channels.'),
    'page callback' => 'drupal_get_form',
    'page arguments' => array('apple_news_settings_channels_form'),
    'access arguments' => array('administer apple news'),
    'file' => 'apple_news.admin.inc',
    'type' => MENU_LOCAL_TASK,
    'weight' => 1,
  );

  $items['admin/config/content/apple-news/settings/channels/%/delete'] = array(
    'title' => 'Delete channel',
    'description' => t('Apple News Push API delete channel.'),
    'page callback' => 'drupal_get_form',
    'page arguments' => array('apple_news_settings_delete_channel_form', 6),
    'access arguments' => array('administer apple news'),
    'file' => 'apple_news.admin.inc',
    'weight' => 1,
  );

  $items['admin/config/content/apple-news/%/%/%/delete'] = array(
    'title' => 'Delete Apple News article',
    'description' => t('Apple News Push API delete channel.'),
    'page callback' => 'drupal_get_form',
    'page arguments' => array('apple_news_settings_delete_article_form', 4, 5, 6),
    'access arguments' => array('administer apple news'),
    'file' => 'apple_news.admin.inc',
    'weight' => 1,
  );

  return $items;
}

/**
 * Implements OBJECT_load().
 *
 * @see menu_get_item()
 */
function apple_news_export_load($id) {
  module_load_include('inc', 'apple_news');
  list($module, $machine_name) = explode('::', $id);
  return apple_news_get_export($module, $machine_name);
}

/**
 * Implements hook_cron().
 */
function apple_news_cron() {
  module_load_include('inc', 'apple_news');
}
