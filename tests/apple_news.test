<?php

/**
 * @file
 * Contains tests for the Apple News module.
 */

module_load_include('inc', 'apple_news', 'push_api');
module_load_include('inc', 'apple_news');
module_load_include('inc', 'apple_news', 'apple_news.batch');

/**
 * Base class for Apple News web tests.
 */
abstract class ApplenewsWebTestCase extends DrupalWebTestCase {

  protected $watchdogSeverityLevel = WATCHDOG_WARNING;

  /**
   * {@inheritdoc}
   */
  public function setUp(array $modules = []) {
    parent::setUp(array_merge(['apple_news', 'dblog'], $modules));
  }

  /**
   * {@inheritdoc}
   *
   * @see http://dcycleproject.org/blog/96/catching-watchdog-errors-your-simpletests
   */
  public function tearDown() {
    $query = db_select('watchdog')
      ->fields(NULL, ['wid'])
      ->condition('severity', $this->watchdogSeverityLevel, '<=')
      ->countQuery();
    $count = $query->execute()->fetchField();
    $this->assertTrue($count == 0, 'Found ' . $count . ' watchdog entries.');
    // Uncomment to debug watchdog table.
    // if (!$count)
    parent::tearDown();
  }

}
