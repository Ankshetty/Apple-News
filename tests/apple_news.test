<?php

/**
 * @file
 * Contains tests for the Apple News module.
 */

use ChapterThree\AppleNewsDoc;

/**
 * Base class for Apple News web tests.
 */
abstract class AppleNewsWebTestCase extends DrupalWebTestCase {

  protected $watchdogSeverityLevel = WATCHDOG_NOTICE;

  /**
   * {@inheritdoc}
   */
  public function setUp(array $modules = array()) {
    parent::setUp(array_merge(array('apple_news', 'dblog'), $modules));
  }

  /**
   * {@inheritdoc}
   *
   * @see http://dcycleproject.org/blog/96/catching-watchdog-errors-your-simpletests
   */
  public function tearDown() {
    $num_errors = $this->getNumWatchdogEntries();
    $expected_errors = 0;
    $this->assertTrue($num_errors == $expected_errors, 'Expected ' . $expected_errors . ' watchdog errors and got ' . $num_errors . '.');

    parent::tearDown();
  }

  /**
   * Get the number of watchdog entries for a given severity or worse.
   *
   * @return int
   *   The number of watchdog errors logged during this test.
   *
   * @see http://dcycleproject.org/blog/96/catching-watchdog-errors-your-simpletests
   */
  public function getNumWatchdogEntries() {
    $results = db_select('watchdog')
        ->fields(NULL, array('wid'))
        ->condition('severity', $this->watchdogSeverityLevel, '<=')
        ->execute()
        ->fetchAll();
    return count($results);
  }

}
