<?php

/**
 * @file
 * Contains tests for the Apple News module.
 */

/**
 * Base class for test cases that create an article.
 */
abstract class AppleNewsArticleTestCase extends DrupalWebTestCase {

  protected $privilegedUser;

  /**
   * Implements setUp().
   */
  public function setUp() {
    parent::setUp(array('apple_news'));
    $this->privilegedUser = $this->drupalCreateUser(array(
      'push content to apple news',
    ));
    $this->drupalLogin($this->privilegedUser);
  }

}

/**
 * Test export to Apple News Format.
 */
class AppleNewsArticleExportTestCase extends AppleNewsArticleTestCase {

  /**
   * Implements getInfo().
   */
  public static function getInfo() {
    return array(
      'name' => t('Export article to Apple News Format'),
      'description' => t(''),
      'group' => t('Apple News'),
    );
  }

  /**
   * Test default article export.
   */
  public function testExport() {
    $title = $this->randomName(32);
    $body = $this->randomName(64);
    $settings = array(
      'type' => 'article',
      'title' => $title,
      'body' => array(LANGUAGE_NONE => array(array($body))),
    );
    $article = $this->drupalCreateNode($settings);
    $this->assert(@$article->nid > 0, 'Article created.');

    $export = new AppleNewsExportArticle('node', $article->nid,
      array());
    $data = json_decode($export->export()->json());
    $this->assertEqual($article->nid, $data->identifier,
      'Export article nid -> identifier.');
    $this->assertEqual($article->title, $data->title,
      'Export article title -> title.');
  }

}
